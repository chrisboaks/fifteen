THREE.OrbitControls=function(e,t){function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function S(){return Math.pow(.95,n.zoomSpeed)}function x(e){if(n.enabled===false){return}e.preventDefault();if(e.button===0){if(n.noRotate===true){return}b=y.ROTATE;i.set(e.clientX,e.clientY)}else if(e.button===1){if(n.noZoom===true){return}b=y.DOLLY;l.set(e.clientX,e.clientY)}else if(e.button===2){if(n.noPan===true){return}b=y.PAN;u.set(e.clientX,e.clientY)}n.domElement.addEventListener("mousemove",T,false);n.domElement.addEventListener("mouseup",N,false)}function T(e){if(n.enabled===false)return;e.preventDefault();var t=n.domElement===document?n.domElement.body:n.domElement;if(b===y.ROTATE){if(n.noRotate===true)return;s.set(e.clientX,e.clientY);o.subVectors(s,i);n.rotateLeft(2*Math.PI*o.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*o.y/t.clientHeight*n.rotateSpeed);i.copy(s)}else if(b===y.DOLLY){if(n.noZoom===true)return;c.set(e.clientX,e.clientY);h.subVectors(c,l);if(h.y>0){n.dollyIn()}else{n.dollyOut()}l.copy(c)}else if(b===y.PAN){if(n.noPan===true)return;a.set(e.clientX,e.clientY);f.subVectors(a,u);n.pan(f);u.copy(a)}n.update()}function N(){if(n.enabled===false)return;n.domElement.removeEventListener("mousemove",T,false);n.domElement.removeEventListener("mouseup",N,false);b=y.NONE}function C(e){if(n.enabled===false||n.noZoom===true)return;var t=0;if(e.wheelDelta){t=e.wheelDelta}else if(e.detail){t=-e.detail}if(t>0){n.dollyOut()}else{n.dollyIn()}}function k(e){if(n.enabled===false){return}if(n.noKeys===true){return}if(n.noPan===true){return}var t=false;switch(e.keyCode){case n.keys.UP:n.pan(new THREE.Vector2(0,n.keyPanSpeed));t=true;break;case n.keys.BOTTOM:n.pan(new THREE.Vector2(0,-n.keyPanSpeed));t=true;break;case n.keys.LEFT:n.pan(new THREE.Vector2(n.keyPanSpeed,0));t=true;break;case n.keys.RIGHT:n.pan(new THREE.Vector2(-n.keyPanSpeed,0));t=true;break}if(t){n.update()}}function L(e){if(n.enabled===false){return}switch(e.touches.length){case 1:if(n.noRotate===true){return}b=y.TOUCH_ROTATE;i.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(n.noZoom===true){return}b=y.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var s=Math.sqrt(t*t+r*r);l.set(0,s);break;case 3:if(n.noPan===true){return}b=y.TOUCH_PAN;u.set(e.touches[0].pageX,e.touches[0].pageY);break;default:b=y.NONE}}function A(e){if(n.enabled===false){return}e.preventDefault();e.stopPropagation();var t=n.domElement===document?n.domElement.body:n.domElement;switch(e.touches.length){case 1:if(n.noRotate===true){return}if(b!==y.TOUCH_ROTATE){return}s.set(e.touches[0].pageX,e.touches[0].pageY);o.subVectors(s,i);n.rotateLeft(2*Math.PI*o.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*o.y/t.clientHeight*n.rotateSpeed);i.copy(s);break;case 2:if(n.noZoom===true){return}if(b!==y.TOUCH_DOLLY){return}var r=e.touches[0].pageX-e.touches[1].pageX;var p=e.touches[0].pageY-e.touches[1].pageY;var d=Math.sqrt(r*r+p*p);c.set(0,d);h.subVectors(c,l);if(h.y>0){n.dollyOut()}else{n.dollyIn()}l.copy(c);break;case 3:if(n.noPan===true){return}if(b!==y.TOUCH_PAN){return}a.set(e.touches[0].pageX,e.touches[0].pageY);f.subVectors(a,u);n.pan(f);u.copy(a);break;default:b=y.NONE}}function O(){if(n.enabled===false){return}b=y.NONE}this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.target=new THREE.Vector3;this.center=this.target;this.noZoom=true;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=true;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=Math.PI/3;this.maxPolarAngle=2*Math.PI/3;this.minTheta=-Math.PI/4;this.maxTheta=Math.PI/4;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var n=this;var r=1e-6;var i=new THREE.Vector2;var s=new THREE.Vector2;var o=new THREE.Vector2;var u=new THREE.Vector2;var a=new THREE.Vector2;var f=new THREE.Vector2;var l=new THREE.Vector2;var c=new THREE.Vector2;var h=new THREE.Vector2;var p=0;var d=0;var v=1;var m=new THREE.Vector3;var g=new THREE.Vector3;var y={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var b=y.NONE;var w={type:"change"};this.rotateLeft=function(e){if(e===undefined){e=E()}d-=e};this.rotateUp=function(e){if(e===undefined){e=E()}p-=e};this.panLeft=function(e){var t=new THREE.Vector3;var n=this.object.matrix.elements;t.set(n[0],n[1],n[2]);t.multiplyScalar(-e);m.add(t)};this.panUp=function(e){var t=new THREE.Vector3;var n=this.object.matrix.elements;t.set(n[4],n[5],n[6]);t.multiplyScalar(e);m.add(t)};this.pan=function(e){var t=n.domElement===document?n.domElement.body:n.domElement;if(n.object.fov!==undefined){var r=n.object.position;var i=r.clone().sub(n.target);var s=i.length();s*=Math.tan(n.object.fov/2*Math.PI/180);n.panLeft(2*e.x*s/t.clientHeight);n.panUp(2*e.y*s/t.clientHeight)}else if(n.object.top!==undefined){n.panLeft(e.x*(n.object.right-n.object.left)/t.clientWidth);n.panUp(e.y*(n.object.top-n.object.bottom)/t.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(e){if(e===undefined){e=S()}v/=e};this.dollyOut=function(e){if(e===undefined){e=S()}v*=e};this.update=function(){var e=this.object.position;var t=e.clone().sub(this.target);var n=Math.atan2(t.x,t.z);var i=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);if(this.autoRotate){this.rotateLeft(E())}n+=d;i+=p;n=Math.max(this.minTheta,Math.min(this.maxTheta,n));i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i));i=Math.max(r,Math.min(Math.PI-r,i));var s=t.length()*v;s=Math.max(this.minDistance,Math.min(this.maxDistance,s));this.target.add(m);t.x=s*Math.sin(i)*Math.sin(n);t.y=s*Math.cos(i);t.z=s*Math.sin(i)*Math.cos(n);e.copy(this.target).add(t);this.object.lookAt(this.target);d=0;p=0;v=1;m.set(0,0,0);if(g.distanceTo(this.object.position)>0){this.dispatchEvent(w);g.copy(this.object.position)}};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",x,false);this.domElement.addEventListener("mousewheel",C,false);this.domElement.addEventListener("DOMMouseScroll",C,false);this.domElement.addEventListener("keydown",k,false);this.domElement.addEventListener("touchstart",L,false);this.domElement.addEventListener("touchend",O,false);this.domElement.addEventListener("touchmove",A,false)};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);(function(){function u(e){if(window.frame.isSliding){return}var n=e.pageX-t.offset().left;var i=e.pageY-t.offset().top;var s=2*(n/600)-1;var o=1-2*(i/600);var u=new THREE.Vector3(s,o,r.near);u.unproject(r);var a=new THREE.Raycaster(r.position,u.sub(r.position).normalize());var f=a.intersectObjects(Fifteen.scene.children,true);console.log(f);if(f.length>0){iObjs=_.map(f,function(e){return e.object.parent});window.frame.handleClick(iObjs)}}window.Fifteen=window.Fifteen||{};var e=Fifteen.scene=new THREE.Scene;var t=$("#gamespace");t.click(u);var n=new THREE.WebGLRenderer;n.setSize(600,600);n.shadowMapEnabled=true;t.append(n.domElement);var r=new THREE.PerspectiveCamera(55,1,.1,300);r.position.z=25;var i=new THREE.OrbitControls(r,document.getElementById("gamespace"));var s=new THREE.SpotLight(15658734,.75);s.position.set(-8,8,40);e.add(s);var o=new THREE.DirectionalLight(16777215,1);o.position.set(-8,8,40);e.add(o);var a=Fifteen.render=function(){requestAnimationFrame(a);n.render(e,r)}})();(function(){window.Fifteen=window.Fifteen||{};var e=Fifteen.Tile=function(e,t){this.frame=e;this.val=t;this.model=this.threeTile(t);this.coordinates=null;if(t!==0){Fifteen.scene.add(this.model)}};var t=4;e.BASE=new THREE.Shape;e.BASE.moveTo(-t/2,-t/2);e.BASE.lineTo(-t/2,t/2);e.BASE.lineTo(t/2,t/2);e.BASE.lineTo(t/2,-t/2);e.BASE.lineTo(-t/2,-t/2);e.GEOMETRY=new THREE.ExtrudeGeometry(e.BASE,{amount:1,steps:2,bevelEnabled:true,bevelThickness:.25,bevelSize:.15,bevelSegments:3});e.MATERIAL=new THREE.MeshPhongMaterial({color:1052784});e.BASEGEOMETRY=new THREE.BoxGeometry(4.75,4.755,.2);e.BASEMATERIAL=new THREE.MeshPhongMaterial({color:12288});e.TEXTMATERIAL=new THREE.MeshLambertMaterial({color:14540253});e.prototype.threeTile=function(t){var n=new THREE.Object3D;var r=new THREE.Mesh(e.GEOMETRY,e.MATERIAL);r.position.z=-1;var i=new THREE.Mesh(e.BASEGEOMETRY,e.BASEMATERIAL);i.position.z=-.4;var s=new THREE.TextGeometry(t,{font:"helvetiker",size:2,height:1,bevelEnabled:true,bevelThickness:.25,bevelSize:.15});var o=new THREE.Mesh(s,e.TEXTMATERIAL);var u=t>9?-1.75:-.75;o.position.set(u,-1,-.5);n.add(r);n.add(o);n.add(i);n.name="Tile "+t;return n};e.prototype.isNeighboringBlank=function(){var e=frame.neighborsOf(this);return _.any(e,function(e){return e.val===0})};e.prototype.setCoordinates=function(e){this.coordinates=e};e.prototype.setFramePosition=function(e){var t=e||this.coordinates;this.model.position.x=(t[1]-1.5)*5;this.model.position.y=(t[0]-1.5)*-5};e.prototype.animate=function(e,t,n){var r=15;if(n<r&&this.val!==0){var i=this;var s=n*(t[1]-e[1])/r;var o=n*(t[0]-e[0])/r;this.model.position.x=(e[1]+s-1.5)*5;this.model.position.y=(e[0]+o-1.5)*-5;setTimeout(function(){i.animate(e,t,n+1)},1e3/60)}else{this.setFramePosition()}};e.prototype.wasClicked=function(e){for(var t=0;t<e.length;t++){if(this.model===e[t]){return true}}return false}})();(function(){window.Fifteen=window.Fifteen||{};var e=Fifteen.Frame=function(){this.tiles=this.populateTiles();this.model=this.threeFrame();Fifteen.scene.add(this.model);this.isSliding=false;this.wasSolved=true;this.setTileCoordinates()};e.prototype.threeFrame=function(){var e=new THREE.Object3D;var t=new THREE.PlaneBufferGeometry(500,500);var n=new THREE.MeshLambertMaterial({color:8421504});var r=new THREE.Mesh(t,n);var i=new THREE.MeshLambertMaterial({color:16766720});var s=this.wallShape();var o=new THREE.ExtrudeGeometry(s,{amount:1,steps:2,bevelEnabled:true,bevelThickness:.25,bevelSize:.15,bevelSegments:3});e.add(r);e.add(new THREE.Mesh(o,i));e.position.z=-1;return e};e.prototype.wallShape=function(e){var t=11.25;var n=10.25;var r=new THREE.Shape;r.moveTo(-t,-t);r.lineTo(t,-t);r.lineTo(t,t);r.lineTo(-t,t);r.lineTo(-t,-t);var i=new THREE.Path;i.moveTo(-n,-n);i.lineTo(n,-n);i.lineTo(n,n);i.lineTo(-n,n);i.lineTo(-n,-n);r.holes.push(i);return r};e.prototype.populateTiles=function(){var e=[];var t=[[],[],[],[]];for(var n=0;n<16;n++){var r=new Fifteen.Tile(this,n);e.push(r)}e.push(e.shift());for(var i=0;i<4;i++){for(var s=0;s<4;s++){var o=e.shift();o.setFramePosition([i,s]);t[i].push(o)}}return t};e.prototype.blank=function(){var e;for(var t=0;t<4;t++){for(var n=0;n<4;n++){e=this.tileAt([t,n]);if(e.val===0){return e}}}};e.prototype.areValidCoords=function(e){var t=e.slice().sort();return t[0]>=0&&t[1]<=3};e.prototype.neighborsOf=function(e){var t=e.coordinates[0];var n=e.coordinates[1];var r=[[t+1,n],[t-1,n],[t,n+1],[t,n-1]];r=_.filter(r,function(e){return this.areValidCoords(e)}.bind(this));return _.map(r,function(e){return this.tileAt(e)}.bind(this))};e.prototype.tileAt=function(e){var t=e[0];var n=e[1];return this.tiles[t][n]};e.prototype.setTile=function(e,t){var n=t[0];var r=t[1];this.tiles[n][r]=e};e.prototype.swap=function(e,t){var n=e.coordinates;var r=t.coordinates;this.setTile(e,r);this.setTile(t,n);e.setCoordinates(r);t.setCoordinates(n)};e.prototype.shuffle=function(){var e=_.flatten(this.tiles);var t=_.filter(e,function(e){return e.val!==0});var n;var r=this.blank().coordinates;var i=6-r[0]-r[1];var s=i%2===0?50:49;for(var o=0;o<s;o++){n=_.sample(t,2);this.swap(n[0],n[1])}this.setTileCoordinates();_.each(e,function(e){e.setFramePosition()});this.displayUnsolved()};e.prototype.slideOne=function(e,t){if(e.isNeighboringBlank()){var n=this.blank();var r=e.coordinates;var i=n.coordinates;this.swap(e,n);setTimeout(function(){e.animate(r,i,0)},t*125)}};e.prototype.slide=function(e){var t=this.blank().coordinates;var n=e.coordinates[0];var r=e.coordinates[1];if(n===t[0]){this.slideMany(e,this.tileRow(n))}else if(r===t[1]){this.slideMany(e,this.tileCol(r))}};e.prototype.tileRow=function(e){return this.tiles[e]};e.prototype.tileCol=function(e){var t=_.zip.apply(_,this.tiles);return t[e]};e.prototype.slideMany=function(e,t){var n=this.blank(),r=t.indexOf(n),i=t.indexOf(e),s=Math.abs(i-r),o=this,u;if(r<i){u=t.slice(r+1,i+1)}else{u=t.slice(i,r).reverse()}o.isSliding=true;for(var a=0;a<s;a++){this.slideOne(u[a],a)}o.displayUnsolved();setTimeout(function(){o.isSliding=false;o.displaySolved()},(s+1)*125)};e.prototype.displaySolved=function(){if(this.isSolved()){this.model.children[1].material.color.setHex(16766720)}};e.prototype.displayUnsolved=function(){if(!this.isSolved()){this.model.children[1].material.color.setHex(11184810)}};e.prototype.handleClick=function(e){if(!this.isSliding){var t=_.flatten(this.tiles);for(var n=0;n<16;n++){if(t[n].wasClicked(e)){this.slide(t[n]);return}}}};e.prototype.setTileCoordinates=function(){for(var e=0;e<4;e++){for(var t=0;t<4;t++){this.tiles[e][t].setCoordinates([e,t])}}};e.prototype.isSolved=function(){var e=_.flatten(this.tiles);for(var t=0;t<15;t++){if(e[t].val!==t+1){return false}}return true}})();window.frame=new Fifteen.Frame;Fifteen.render();$("#shuffle").click(function(){window.frame.shuffle()})
